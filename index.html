<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beth's Book Club</title>
    <!-- Tailwind CSS CDN for sleek styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs (Modular versions) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beth's Book Club</title>
    <!-- Tailwind CSS CDN for sleek styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs (Modular versions) -->
    <script type="module">
        // Basic console log to confirm script is loading
        console.log("Beth's Book Club script is loading...");

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, deleteDoc, onSnapshot, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";

        // Global Firebase variables
        window.firebaseApp = null;
        window.db = null;
        window.auth = null;
        window.adminUserId = null;
        window.analytics = null;
        
        // Global data stores
        window.recommendedBooks = [];
        window.bookShelfBooks = [];
        window.flaggedBooks = [];
        window.bethDeletedBooks = [];
        window.adminAlerts = [];
        window.adminPendingRecommendations = [];
        window.adminApprovedBooks = [];

        // UI ready flag
        window.uiReadyForDisplay = false;
        window.listenersReady = false;

        // Fixed PINs for login
        const BETH_PIN = '7288';
        const ADMIN_PIN = '2384';
        const BETH_FIREBASE_USER_ID = 'beth_unique_book_club_id_7288';

        // Firebase initialization
        const firebaseConfig = {
            apiKey: "AIzaSyAFy0zdwfRbLuOHLvrjRpCo1WVAM_6JES4",
            authDomain: "beths-book-club.firebaseapp.com",
            projectId: "beths-book-club",
            storageBucket: "beths-book-club.firebasestorage.app",
            messagingSenderId: "383122582606",
            appId: "1:383122582606:web:b187ccfa0bcfeaba7a671f",
            measurementId: "G-X584KXZ8TX"
        };

        // Initialize Firebase
        try {
            window.firebaseApp = initializeApp(firebaseConfig);
            window.db = getFirestore(window.firebaseApp);
            window.auth = getAuth(window.firebaseApp);
            window.analytics = getAnalytics(window.firebaseApp);
            console.log("Firebase initialized successfully.");
        } catch (error) {
            console.error("ERROR: Failed to initialize Firebase:", error);
        }

        /**
         * Safe element getter
         */
        function safeGetElementSync(elementId) {
            const element = document.getElementById(elementId);
            if (!element) {
                console.warn(`Element '${elementId}' not found`);
            }
            return element;
        }

        /**
         * Initializes the main application after successful PIN login
         */
        async function initializeAppContent(isAdminLogin = false) {
            window.adminUserId = BETH_FIREBASE_USER_ID;
            console.log("App Content Initialized: Admin User ID set to", window.adminUserId);
            console.log(`initializeAppContent: isAdminLogin = ${isAdminLogin}`);

            // Hide login screen
            const loginScreen = safeGetElementSync('login-screen');
            if (loginScreen) loginScreen.classList.add('hidden');
            
            // Show splash screen
            const splashScreen = safeGetElementSync('splash-screen');
            if (splashScreen) splashScreen.classList.remove('hidden');
            console.log("initializeAppContent: Showing splash screen.");

            // Set admin panel visibility based on login type
            setAdminUIVisibility(isAdminLogin);

            // Show the "Ready for More Recommendations!" button
            const requestMoreContainer = safeGetElementSync('request-more-recs-container');
            if (requestMoreContainer) requestMoreContainer.classList.remove('hidden');
            console.log("initializeAppContent: 'Ready for More Recommendations' button visible.");
        }

        /**
         * Controls the visibility of admin-specific UI elements
         */
        function setAdminUIVisibility(showAdmin) {
            const adminPanel = safeGetElementSync('admin-search-panel');
            const navFlaggedBooks = safeGetElementSync('nav-flagged-books');
            const navAdminApprovedBooks = safeGetElementSync('nav-admin-approved-books');

            if (adminPanel) adminPanel.classList.toggle('hidden', !showAdmin);
            if (navFlaggedBooks) navFlaggedBooks.classList.toggle('hidden', !showAdmin);
            if (navAdminApprovedBooks) navAdminApprovedBooks.classList.toggle('hidden', !showAdmin);

            console.log(`setAdminUIVisibility: Admin panel set to ${showAdmin ? 'visible' : 'hidden'}.`);
        }

        /**
         * Displays a temporary message
         */
        function showMessage(text, isLoader = false, isLlmInsight = false) {
            const messageBox = safeGetElementSync('message-box');
            const messageText = safeGetElementSync('message-text');
            const closeButton = safeGetElementSync('message-box-close');

            if (!messageBox || !messageText || !closeButton) {
                console.error("Message box elements not found");
                return;
            }

            messageText.innerHTML = isLoader ? `<div class="loader"></div><p class="mt-4">${text}</p>` : text;
            messageBox.classList.toggle('llm-insight', isLlmInsight);
            closeButton.style.display = isLoader ? 'none' : 'block';
            messageBox.style.display = 'block';
            console.log(`showMessage: Displaying message: "${text}"`);

            if (!isLoader && !isLlmInsight) {
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, 5000);
            }
        }

        /**
         * Controls which main view section is visible
         */
        function showView(viewId) {
            console.log(`showView: Attempting to show view: ${viewId}`);
            const views = ['recommendations-view', 'bookshelf-view', 'beth-deleted-books-view', 'flagged-books-view', 'admin-approved-books-view'];
            
            views.forEach(id => {
                const viewElement = safeGetElementSync(id);
                if (viewElement) {
                    if (id === viewId) {
                        viewElement.classList.remove('hidden');
                    } else {
                        viewElement.classList.add('hidden');
                    }
                }
            });

            // Update active state for navigation buttons
            document.querySelectorAll('.nav-button').forEach(button => {
                if (button.id === `nav-${viewId.replace('-view', '')}`) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
        }

        /**
         * Handles logging out
         */
        function handleLogout() {
            const mainContent = safeGetElementSync('main-content');
            const splashScreen = safeGetElementSync('splash-screen');
            const loginScreen = safeGetElementSync('login-screen');
            const pinInput = safeGetElementSync('pin-input');

            if (mainContent) mainContent.classList.add('hidden');
            if (splashScreen) splashScreen.classList.add('hidden');
            if (loginScreen) loginScreen.classList.remove('hidden');
            if (pinInput) pinInput.value = '';

            setAdminUIVisibility(false);
            window.uiReadyForDisplay = false;
            console.log("Logged out. Returning to login screen.");
        }

        /**
         * Close message box helper
         */
        function closeMessageBox() {
            const messageBox = safeGetElementSync('message-box');
            if (messageBox) {
                messageBox.style.display = 'none';
                messageBox.classList.remove('llm-insight');
            }
        }

        // Make functions globally accessible
        window.initializeAppContent = initializeAppContent;
        window.showView = showView;
        window.handleLogout = handleLogout;
        window.showMessage = showMessage;

        // DOM Content Loaded Event Listener (SINGLE VERSION)
        document.addEventListener('DOMContentLoaded', async () => {
            console.log("DOM Content Loaded - Setting up event listeners");

            // Set the current year in the footer
            const currentYearElement = safeGetElementSync('current-year');
            if (currentYearElement) {
                currentYearElement.textContent = new Date().getFullYear();
            }

            // PIN Login Event Listener
            const pinInput = safeGetElementSync('pin-input');
            const loginButton = safeGetElementSync('login-button');
            const loginMessage = safeGetElementSync('login-message');

            if (loginButton) {
                loginButton.addEventListener('click', () => {
                    console.log("Login button clicked.");
                    const enteredPin = pinInput ? pinInput.value.trim() : '';
                    console.log("Entered PIN:", enteredPin);
                    
                    if (enteredPin === BETH_PIN) {
                        if (loginMessage) loginMessage.textContent = '';
                        console.log("Beth's PIN entered. Initializing app for Beth.");
                        initializeAppContent(false);
                    } else if (enteredPin === ADMIN_PIN) {
                        if (loginMessage) loginMessage.textContent = '';
                        console.log("Admin PIN entered. Initializing app for Admin.");
                        initializeAppContent(true);
                    } else {
                        if (loginMessage) {
                            loginMessage.textContent = 'Incorrect PIN. Please try again.';
                            loginMessage.classList.remove('hidden');
                        }
                        console.log("Incorrect PIN entered:", enteredPin);
                    }
                });
                console.log("Login button event listener attached successfully");
            } else {
                console.error("Login button not found!");
            }

            // Enter key support for PIN input
            if (pinInput) {
                pinInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        loginButton?.click();
                    }
                });
                console.log("PIN input enter key listener attached");
            }

            // Navigation Buttons
            const navButtons = [
                { id: 'nav-recommendations', view: 'recommendations-view' },
                { id: 'nav-bookshelf', view: 'bookshelf-view' },
                { id: 'nav-beth-deleted-books', view: 'beth-deleted-books-view' },
                { id: 'nav-flagged-books', view: 'flagged-books-view' },
                { id: 'nav-admin-approved-books', view: 'admin-approved-books-view' }
            ];

            navButtons.forEach(({ id, view }) => {
                const button = safeGetElementSync(id);
                if (button) {
                    button.addEventListener('click', () => showView(view));
                }
            });

            // Logout Button
            const logoutButton = safeGetElementSync('logout-button');
            if (logoutButton) {
                logoutButton.addEventListener('click', handleLogout);
            }

            // Splash Screen Continue Button
            const splashContinueButton = safeGetElementSync('splash-continue-button');
            if (splashContinueButton) {
                splashContinueButton.addEventListener('click', () => {
                    const splashScreen = safeGetElementSync('splash-screen');
                    const mainContent = safeGetElementSync('main-content');
                    
                    if (splashScreen) splashScreen.classList.add('hidden');
                    if (mainContent) mainContent.classList.remove('hidden');
                    
                    window.uiReadyForDisplay = true;
                    console.log("UI is now ready for display");
                    
                    showView('recommendations-view');
                });
            }

            // Close button for message box
            const messageBoxClose = safeGetElementSync('message-box-close');
            if (messageBoxClose) {
                messageBoxClose.addEventListener('click', closeMessageBox);
            }

            console.log("All event listeners set up successfully");
        });
    </script>
    <style>
        /* Custom styles for the Inter font and overall look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #334155;
            line-height: 1.6;
        }
        .book-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInSlideUp 0.5s ease-out forwards;
        }
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .book-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 0.5rem;
        }

        .bookshelf-card-small {
            width: 160px;
            flex-shrink: 0;
            margin: 0.5rem;
            text-align: center;
        }

        .bookshelf-card-small .book-image {
            height: 180px;
        }

        .book-description {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .book-link {
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .star-rating {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            justify-content: center;
        }

        .action-button {
            background-color: #059669;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-align: center;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            cursor: pointer;
            border: none;
            width: fit-content;
            margin-top: auto;
        }
        .action-button:hover {
            background-color: #047857;
            transform: translateY(-1px);
        }

        .nav-button {
            background-color: transparent;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            border: 1px solid transparent;
        }
        .nav-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .nav-button.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 1.5rem 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            text-align: center;
            font-size: 1.125rem;
            font-weight: 500;
            color: #1f2937;
            max-width: 90%;
            word-wrap: break-word;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #059669;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: none;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Message box for pick confirmation and other messages -->
    <div id="message-box" class="message-box">
        <p id="message-text"></p>
        <button id="message-box-close" class="mt-4 px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700">Close</button>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-gray-100">
        <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-sm text-center">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Beth's Book Club Login</h2>
            <input type="password" id="pin-input" placeholder="Enter 4-digit PIN" maxlength="4"
                   class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 text-gray-700 text-center text-xl tracking-widest">
            <button id="login-button" class="action-button w-full mt-6 px-6 py-3 bg-emerald-600 hover:bg-emerald-700">Login</button>
            <p id="login-message" class="text-red-500 mt-4 hidden"></p>
            <button id="forgot-pin-button" class="text-blue-600 hover:underline mt-4 text-sm">Forgot PIN?</button>
        </div>
    </div>

    <!-- Splash Screen -->
    <div id="splash-screen" class="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-emerald-500 to-emerald-700 text-white p-4 hidden">
        <h2 class="text-5xl font-extrabold mb-6 text-center animate-pulse">Welcome, Beth!</h2>
        <p class="text-xl text-center mb-8 max-w-lg">
            Your personalized book recommendations are ready. Let's find your next favorite read!
        </p>
        <button id="splash-continue-button" class="action-button px-8 py-4 text-lg bg-white text-emerald-700 hover:bg-gray-100 transition-colors duration-300">
            Start Reading
        </button>
    </div>

    <!-- Main Content Area -->
    <div id="main-content" class="min-h-screen flex flex-col hidden">
        <!-- Header Section -->
        <header class="bg-gradient-to-r from-emerald-800 to-gray-900 text-white shadow-lg py-6 px-4 sm:px-6 lg:px-8">
            <div class="max-w-7xl mx-auto flex flex-col sm:flex-row justify-between items-center">
                <h1 class="text-4xl font-extrabold tracking-tight mb-2 sm:mb-0 flex items-center gap-2" id="main-title">
                    Beth's Book Club
                </h1>
                <p class="text-xl opacity-90">Curated reads for you, my love.</p>
                <button id="logout-button" class="action-button bg-red-500 hover:bg-red-600 px-4 py-2 text-sm mt-4 sm:mt-0">Logout</button>
            </div>
            <nav class="max-w-7xl mx-auto mt-4 flex justify-center space-x-4">
                <button id="nav-recommendations" class="nav-button active">Recommended Reads</button>
                <button id="nav-bookshelf" class="nav-button">My Bookshelf</button>
                <button id="nav-beth-deleted-books" class="nav-button hidden">Deleted Books</button>
                <button id="nav-flagged-books" class="nav-button hidden">Flagged Books</button>
                <button id="nav-admin-approved-books" class="nav-button hidden">Admin Approved</button>
            </nav>
        </header>

        <!-- Admin Search Section -->
        <section id="admin-search-panel" class="py-8 px-4 sm:px-6 lg:px-8 bg-gray-100 border-b border-gray-200 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Admin: Find & Add Books</h2>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mt-8">
                    <input type="text" id="search-input" placeholder="Search by title or author..."
                           class="flex-grow p-3 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 text-gray-700">
                    <button id="search-button" class="action-button px-6 py-3">Search Books</button>
                </div>
            </div>
        </section>

        <!-- Main Content Area for Curated Books -->
        <main id="recommendations-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-7xl mx-auto">
                <h2 id="recommended-reads-heading" class="text-3xl font-bold text-center mb-10 text-gray-800">Recommended Reads (This Month)</h2>
                <div id="book-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Book cards will be inserted here -->
                </div>
                <p id="no-books-message" class="text-center text-gray-600 mt-4">No books recommended yet. New recommendations will be added soon!</p>
                <div id="request-more-recs-container" class="mt-10 text-center hidden">
                    <button id="request-more-recs-button" class="action-button px-8 py-4 text-lg bg-blue-500 hover:bg-blue-600">Ready for More Recommendations!</button>
                </div>
            </div>
        </main>

        <!-- Beth's Bookshelf Section -->
        <section id="bookshelf-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">Beth's Bookshelf</h2>
                <div id="bookshelf-list" class="flex flex-wrap justify-center gap-4">
                    <!-- Bookshelf books will be inserted here -->
                </div>
                <p id="no-bookshelf-message" class="text-center text-gray-600 mt-4">No books on your bookshelf yet.</p>
            </div>
        </section>

        <!-- Beth's Deleted Books Section -->
        <section id="beth-deleted-books-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">Beth's Deleted Books</h2>
                <div id="beth-deleted-books-list" class="flex flex-wrap justify-center gap-4">
                    <!-- Deleted books will be inserted here -->
                </div>
                <p id="no-beth-deleted-books-message" class="text-center text-gray-600 mt-4">No deleted books yet.</p>
            </div>
        </section>

        <!-- Admin Flagged Books Section -->
        <section id="flagged-books-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">Admin: Flagged Books</h2>
                <div id="flagged-books-list" class="flex flex-wrap justify-center gap-4">
                    <!-- Flagged books will be inserted here -->
                </div>
                <p id="no-flagged-books-message" class="text-center text-gray-600 mt-4">No flagged books yet.</p>
            </div>
        </section>

        <!-- Admin Approved Books Section -->
        <section id="admin-approved-books-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">Admin: Approved Books</h2>
                <div id="admin-approved-books-list" class="flex flex-wrap justify-center gap-4">
                    <!-- Approved books will be inserted here -->
                </div>
                <p id="no-admin-approved-books-message" class="text-center text-gray-600 mt-4">No approved books awaiting placement.</p>
            </div>
        </section>

        <!-- Footer Section -->
        <footer class="bg-gray-800 text-gray-300 py-8 px-4 sm:px-6 lg:px-8 mt-auto">
            <div class="max-w-7xl mx-auto text-center">
                <p>&copy; <span id="current-year"></span> Beth's Book Club. All rights reserved.</p>
                <p class="text-sm mt-2">Designed with ❤️ for you.</p>
            </div>
        </footer>
    </div>
</body>
</html>
    <style>
        /* Custom styles for the Inter font and overall look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background for matte, earthy feel */
            color: #334155; /* Darker text for contrast */
            line-height: 1.6;
        }
        .book-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            opacity: 0; /* Start hidden for fade-in animation */
            transform: translateY(20px); /* Start slightly below for slide-up effect */
            animation: fadeInSlideUp 0.5s ease-out forwards; /* Apply animation */
        }
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        /* Keyframe animation for fade-in and slide-up */
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ensure images maintain aspect ratio and fit within their containers */
        .book-image {
            width: 100%;
            height: 250px; /* Fixed height for consistency */
            object-fit: cover; /* Cover the area, cropping if necessary */
            border-radius: 0.5rem; /* Rounded corners for images */
        }

        /* Styles for smaller bookshelf cards */
        .bookshelf-card-small {
            width: 160px; /* Fixed smaller width for bookshelf cards */
            flex-shrink: 0; /* Prevent shrinking in flex containers */
            margin: 0.5rem; /* Small margin around cards */
            text-align: center;
        }

        .bookshelf-card-small .book-image {
            height: 180px; /* Smaller height for images in bookshelf */
        }

        .bookshelf-card-small .p-6 {
            padding: 0.75rem; /* Reduced padding for smaller cards */
        }

        .bookshelf-card-small .text-xl {
            font-size: 1rem; /* Smaller title font size */
        }

        .bookshelf-card-small .text-sm {
            font-size: 0.75rem; /* Smaller author/year font size */
        }

        .bookshelf-card-small .book-description {
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Limit description to 3 lines for smaller cards */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.8rem; /* Smaller description font size */
        }

        .bookshelf-card-small .star-rating svg {
            width: 1rem; /* Smaller stars for bookshelf */
            height: 1rem;
        }


        /* Responsive adjustments for description text (main view) */
        .book-description {
            display: -webkit-box;
            -webkit-line-clamp: 4; /* Limit to 4 lines */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        @media (min-width: 768px) {
            .book-description {
                -webkit-line-clamp: 6; /* More lines on larger screens */
            }
        }
        /* Remove underline from links within book cards */
        .book-link {
            text-decoration: none;
            color: inherit; /* Inherit text color from parent */
            display: flex; /* Make the link fill its container */
            flex-direction: column; /* Stack content vertically */
            height: 100%; /* Ensure the link takes full height of the card */
        }
        /* Star rating styles */
        .star-rating {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            justify-content: center; /* Center stars in small cards */
        }
        .star-rating svg {
            width: 1.25rem; /* Size of the star icon */
            height: 1.25rem;
            fill: #facc15; /* Yellow color for filled stars */
            stroke: #facc15; /* Stroke color for consistency */
            margin-right: 0.125rem; /* Small space between stars */
        }
        .star-rating .empty-star {
            fill: #d1d5db; /* Light gray for empty stars */
            stroke: #d1d5db;
        }

        /* Button styling */
        .action-button {
            background-color: #059669; /* Emerald 600 - Green */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-align: center;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            cursor: pointer;
            border: none; /* Remove default button border */
            width: fit-content; /* Adjust width to content */
            margin-top: auto; /* Push button to the bottom of the card */
        }
        .action-button:hover {
            background-color: #047857; /* Emerald 700 - Darker Green on hover */
            transform: translateY(-1px);
        }
        .action-button:active {
            transform: translateY(0);
        }

        /* Specific button colors */
        .action-button.recommend-btn {
            background-color: #e11d48; /* Rose 600 - Pink */
        }
        .action-button.recommend-btn:hover {
            background-color: #be123c; /* Rose 700 - Darker Pink on hover */
        }
        .action-button.insight-btn {
            background-color: #d97706; /* Amber 600 - Yellow */
        }
        .action-button.insight-btn:hover {
            background-color: #b45309; /* Amber 700 - Darker Yellow on hover */
        }
        .action-button.pass-btn { /* New style for pass button */
            background-color: #6b7280; /* Gray 500 */
        }
        .action-button.pass-btn:hover {
            background-color: #4b5563; /* Gray 600 */
        }
        .action-button.red-flag-btn { /* New style for red flag button */
            background-color: #dc2626; /* Red 600 */
        }
        .action-button.red-flag-btn:hover {
            background-color: #b91c1c; /* Red 700 */
        }
        .nav-button {
            background-color: transparent;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            border: 1px solid transparent;
        }
        .nav-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .nav-button.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .remove-admin-button {
            background-color: #dc2626; /* Red-600 */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-align: center;
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
            border: none;
            width: 100%; /* Full width within its container */
            margin-top: 1rem; /* Space above */
        }

        .remove-admin-button:hover {
            background-color: #b91c1c; /* Red-700 */
        }

        /* Review buttons specific styling */
        .review-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: center; /* Center the buttons */
        }
        .review-button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid #cbd5e1; /* Light gray border */
            background-color: #f8fafc; /* Light background */
            color: #475569; /* Slate 700 */
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }
        .review-button:hover {
            background-color: #e2e8f0; /* Lighter on hover */
        }
        .review-button.selected-mid {
            background-color: #fca5a5; /* Red-300 */
            border-color: #ef4444; /* Red-500 */
            color: #7f1d1d; /* Red-900 */
        }
        .review-button.selected-like {
            background-color: #a7f3d0; /* Green-200 */
            border-color: #10b981; /* Green-500 */
            color: #064e3b; /* Green-900 */
        }
        .review-button.selected-love {
            background-color: #bfdbfe; /* Blue-200 */
            border-color: #3b82f6; /* Blue-500 */
            color: #1e3a8a; /* Blue-900 */
        }

        /* Styles for review buttons inside small bookshelf cards */
        .bookshelf-card-small .review-buttons {
            flex-wrap: wrap; /* Allow buttons to wrap */
            gap: 0.25rem; /* Smaller gap */
            margin-top: 0.5rem; /* Reduced margin */
        }
        .bookshelf-card-small .review-button {
            padding: 0.3rem 0.6rem; /* Smaller padding */
            font-size: 0.7rem; /* Smaller font size */
        }


        /* Message box for pick confirmation and LLM insights */
        .message-box {
            position: fixed;
            top: 50% ;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 1.5rem 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none; /* Hidden by default */
            text-align: center;
            font-size: 1.125rem;
            font-weight: 500;
            color: #1f2937;
            max-width: 90%; /* Ensure it's responsive */
            word-wrap: break-word; /* Prevent overflow for long text */
        }
        .message-box.llm-insight {
            max-width: 600px; /* Wider for LLM insights */
            text-align: left;
            font-size: 1rem;
        }


        /* Loader styling */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #059669; /* Emerald 600 - Green */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Source tag styling */
        .source-tag {
            display: inline-block;
            background-color: #e0f2f7; /* Light blue */
            color: #083344; /* Dark blue text */
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: 0.5rem;
        }

        /* Admin Alert specific styling */
        .admin-alert-container {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .admin-alert-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: #fef3c7; /* Light yellow for alerts */
            border-left: 4px solid #f59e0b; /* Amber border */
            border-radius: 0.25rem;
            font-size: 0.9rem;
            color: #78350f; /* Darker amber text */
        }
        .admin-alert-item:last-child {
            margin-bottom: 0;
        }
        .admin-alert-item .dismiss-button {
            background-color: #f59e0b;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .admin-alert-item .dismiss-button:hover {
            background-color: #d97706;
        }

        /* New styles for admin pending recommendations */
        .admin-pending-recs-container {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .admin-pending-rec-item {
            display: flex;
            flex-direction: column;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: #e0f2fe; /* Light blue for pending */
            border-left: 4px solid #3b82f6; /* Blue border */
            border-radius: 0.25rem;
            font-size: 0.9rem;
            color: #1e40af; /* Darker blue text */
        }
        .admin-pending-rec-item .book-info {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .admin-pending-rec-item .approve-button {
            background-color: #3b82f6;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            align-self: flex-end; /* Align button to the right */
        }
        .admin-pending-rec-item .approve-button:hover {
            background-color: #2563eb;
        }

        /* New styles for admin approved books */
        .admin-approved-books-container {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .admin-approved-book-item {
            display: flex;
            flex-direction: column;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background-color: #d1fae5; /* Light green for approved */
            border-left: 4px solid #10b981; /* Green border */
            border-radius: 0.25rem;
            font-size: 0.9rem;
            color: #065f46; /* Darker green text */
        }
        .admin-approved-book-item .book-info {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .admin-approved-book-item .move-to-recs-button {
            background-color: #10b981;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            align-self: flex-end;
        }
        .admin-approved-book-item .move-to-recs-button:hover {
            background-color: #059669;
        }
    </style>
</head>
<body class="antialiased">
    <!-- Message box for pick confirmation and other messages -->
    <div id="message-box" class="message-box">
        <p id="message-text"></p>
        <button id="message-box-close" class="mt-4 px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700">Close</button>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center bg-gray-100">
        <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-sm text-center">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Beth's Book Club Login</h2>
            <input type="password" id="pin-input" placeholder="Enter 4-digit PIN" maxlength="4"
                   class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 text-gray-700 text-center text-xl tracking-widest">
            <button id="login-button" class="action-button w-full mt-6 px-6 py-3 bg-emerald-600 hover:bg-emerald-700">Login</button>
            <p id="login-message" class="text-red-500 mt-4 hidden"></p>
            <button id="forgot-pin-button" class="text-blue-600 hover:underline mt-4 text-sm">Forgot PIN?</button>
        </div>
    </div>

    <!-- Splash Screen (Hidden by default, shown after successful login) -->
    <div id="splash-screen" class="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-emerald-500 to-emerald-700 text-white p-4 hidden">
        <h2 class="text-5xl font-extrabold mb-6 text-center animate-pulse">Welcome, Beth!</h2>
        <p class="text-xl text-center mb-8 max-w-lg">
            Your personalized book recommendations are ready. Let's find your next favorite read!
        </p>
        <button id="splash-continue-button" class="action-button px-8 py-4 text-lg bg-white text-emerald-700 hover:bg-gray-100 transition-colors duration-300">
            Start Reading
        </button>
    </div>

    <!-- Main Content Area (Now always in DOM, its children are hidden) -->
    <div id="main-content" class="min-h-screen flex flex-col">
        <!-- Header Section -->
        <header class="bg-gradient-to-r from-emerald-800 to-gray-900 text-white shadow-lg py-6 px-4 sm:px-6 lg:px-8">
            <div class="max-w-7xl mx-auto flex flex-col sm:flex-row justify-between items-center">
                <h1 class="text-4xl font-extrabold tracking-tight mb-2 sm:mb-0 flex items-center gap-2" id="main-title">
                    Beth's Book Club
                </h1>
                <p class="text-xl opacity-90">Curated reads for you, my love.</p>
                <!-- Logout Button -->
                <button id="logout-button" class="action-button bg-red-500 hover:bg-red-600 px-4 py-2 text-sm mt-4 sm:mt-0">Logout</button>
            </div>
            <nav class="max-w-7xl mx-auto mt-4 flex justify-center space-x-4">
                <button id="nav-recommendations" class="nav-button active">Recommended Reads</button>
                <button id="nav-bookshelf" class="nav-button">My Bookshelf</button>
                <!-- New tab for Beth's deleted books -->
                <button id="nav-beth-deleted-books" class="nav-button hidden">Deleted Books</button>
                <!-- Admin-only tabs, initially hidden and controlled by PIN login -->
                <button id="nav-flagged-books" class="nav-button hidden">Flagged Books</button>
                <button id="nav-admin-approved-books" class="nav-button hidden">Admin Approved</button>
            </nav>
        </header>

        <!-- Admin Search Section (Initially Hidden and controlled by PIN login) -->
        <section id="admin-search-panel" class="py-8 px-4 sm:px-6 lg:px-8 bg-gray-100 border-b border-gray-200 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Admin: Find & Add Books</h2>

                <!-- Admin Alerts Container -->
                <div id="admin-alerts-container" class="admin-alert-container hidden">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Admin Alerts</h3>
                    <div id="admin-alerts-list">
                        <!-- Admin alerts will be displayed here -->
                    </div>
                    <p id="no-admin-alerts-message" class="text-center text-gray-600 mt-4 hidden"></p>
                </div>

                <!-- Admin Pending Recommendations Container -->
                <div id="admin-pending-recs-container" class="admin-pending-recs-container hidden">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Admin: Pending Recommendations</h3>
                    <div id="admin-pending-recs-list">
                        <!-- Pending recommendations will be displayed here -->
                    </div>
                    <p id="no-admin-pending-recs-message" class="text-center text-gray-600 mt-4 hidden"></p>
                </div>

                <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mt-8">
                    <input type="text" id="search-input" placeholder="Search by title or author..."
                           class="flex-grow p-3 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 text-gray-700">
                    <button id="search-button" class="action-button px-6 py-3">Search Books</button>
                    <button id="recommend-button" class="action-button recommend-btn px-6 py-3">Get Recommendations</button>
                </div>

                <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
                   <input type="text" id="manual-add-url-input" placeholder="Paste Open Library URL (works or books: https://openlibrary.org/works/OL12345W or https://openlibrary.org/books/OL12345M)"
       class="flex-grow p-3 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 text-gray-700">
                    <button id="manual-add-button" class="action-button px-6 py-3 bg-blue-600 hover:bg-blue-700">Add Manually</button>
                </div>

                <!-- New: Evaluate Book for Beth -->
                <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
                 <input type="text" id="evaluate-book-url-input" placeholder="Evaluate Book for Beth (Open Library URL: works or books)"
       class="flex-grow p-3 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 text-gray-700">     <button id="evaluate-book-button" class="action-button px-6 py-3 bg-purple-600 hover:bg-purple-700">Evaluate Book</button>
                </div>


                <div id="search-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-8">
                    <!-- Search results will be displayed here -->
                </div>
                <div id="search-loader" class="loader"></div>
                <p id="search-message" class="text-center text-gray-600 mt-4 hidden"></p>
            </div>
        </section>

        <!-- Main Content Area for Curated Books -->
        <main id="recommendations-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 id="recommended-reads-heading" class="text-3xl font-bold text-center mb-10 text-gray-800">Recommended Reads (This Month)</h2>
                <div id="book-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Curated book cards will be dynamically inserted here by JavaScript -->
                </div>
                <p id="no-books-message" class="text-center text-gray-600 mt-4 hidden"></p>
                <!-- New button for Beth to request more recommendations (visibility controlled by PIN login) -->
                <div id="request-more-recs-container" class="mt-10 text-center hidden">
                    <button id="request-more-recs-button" class="action-button px-8 py-4 text-lg bg-blue-500 hover:bg-blue-600">Ready for More Recommendations!</button>
                </div>
            </div>
        </main>

        <!-- Beth's Bookshelf Section -->
        <section id="bookshelf-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">Beth's Bookshelf</h2>
                <!-- Adjusted grid for smaller cards on bookshelf -->
                <div id="bookshelf-list" class="flex flex-wrap justify-center gap-4">
                    <!-- Books from the bookshelf will be dynamically inserted here -->
                </div>
                <p id="no-bookshelf-message" class="text-center text-gray-600 mt-4 hidden"></p>
            </div>
        </section>

        <!-- Beth's Deleted Books Section (Always visible) -->
        <section id="beth-deleted-books-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">Beth's Deleted Books</h2>
                <div id="beth-deleted-books-list" class="flex flex-wrap justify-center gap-4">
                    <!-- Beth's deleted books will be dynamically inserted here -->
                </div>
                <p id="no-beth-deleted-books-message" class="text-center text-gray-600 mt-4 hidden"></p>
            </div>
        </section>

        <!-- Admin Flagged Books Section (Initially Hidden and controlled by PIN login) -->
        <section id="flagged-books-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">Admin: Flagged Books</h2>
                <div id="flagged-books-list" class="flex flex-wrap justify-center gap-4">
                    <!-- Flagged books (passed/red-flagged) will be dynamically inserted here -->
                </div>
                <p id="no-flagged-books-message" class="text-center text-gray-600 mt-4 hidden"></p>
            </div>
        </section>

        <!-- Admin Approved Books Section (Initially Hidden and controlled by PIN login) -->
        <section id="admin-approved-books-view" class="flex-grow py-12 px-4 sm:px-6 lg:px-8 hidden">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">Admin: Approved Books</h2>
                <div id="admin-approved-books-list" class="flex flex-wrap justify-center gap-4">
                    <!-- Admin approved books will be dynamically inserted here -->
                </div>
                <p id="no-admin-approved-books-message" class="text-center text-gray-600 mt-4 hidden"></p>
            </div>
        </section>

        <!-- Footer Section -->
        <footer class="bg-gray-800 text-gray-300 py-8 px-4 sm:px-6 lg:px-8 mt-auto">
            <div class="max-w-7xl mx-auto text-center">
                <p>&copy; <span id="current-year"></span> Beth's Book Club. All rights reserved.</p>
                <p class="text-sm mt-2">Designed with ❤️ for you.</p>
            </div>
        </footer>
    </div>
</body>
</html>
